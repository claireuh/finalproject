import requests
import matplotlib.pyplot as plt
import os
import sqlite3
import unittest
import numpy as np
import json


def setUpDatabase(db_name):
    path = os.path.dirname(os.path.abspath(__file__))
    conn = sqlite3.connect(path+'/'+db_name)
    cur = conn.cursor()
    return cur, conn

#f346c59968a4bc43d890eaacf2a45895

def get_sstock():
    url = 'http://api.marketstack.com/v1/eod?access_key=f346c59968a4bc43d890eaacf2a45895&symbols=VOO'
    response = requests.get(url)
    data = response.text
    data_list = json.loads(data)
    return data_list



#Open
#Close
#Volume
#Date


def get_data_to_databse(cur,conn,data_list):
    cur.execute("DROP TABLE IF EXISTS voo")
    cur.execute("CREATE TABLE voo (open REAL, close REAL, volume INTEGER, date TEXT)")
    for i in data_list['data']:
        cur.execute("INSERT INTO voo (open,close,volume,date) VALUES (?,?,?,?)",(i['open'],i['close'],i['volume'],i['date']))
    conn.commit()







def main():
    cur, conn = setUpDatabase('voo.db')
    get_sstock()
    data_list = get_sstock()
    print(get_data_to_databse(cur,conn,data_list))

    
    
if __name__ == "__main__":
    main()
